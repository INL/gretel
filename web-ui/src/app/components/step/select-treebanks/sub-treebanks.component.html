<div class="section" *ngIf="loading">
    <progress class="progress is-primary is-large" max="100">Loading...</progress>
</div>
<div *ngIf="!loading && !showComponents" class="section" style="padding-top: 0;">
    <em>This treebank contains many components, are you sure you want to list them all?</em><br>
    <button type="button" class="button is-primary" (click)="showComponents = true">Show all components</button>
</div>
<table class="table is-hoverable is-fullwidth" *ngIf="!loading && showComponents">
    <thead>
        <tr>
            <th [attr.colspan]="variants ? variants.length : 1">
                <label class="checkbox" *ngIf="treebank.multiOption">
                    <input type="checkbox" title="Select all" [checked]="allSelected"
                        (change)="toggleVariant(undefined)">
                    Component
                </label>
                <span *ngIf="!treebank.multiOption">Component</span>
            </th>
            <th *ngIf="showDescription">
                Description
            </th>
            <ng-container *ngFor="let variant of (variants || []).concat('')">
                <th class="has-text-right">
                    Sentences
                </th>
                <th class="has-text-right" *ngIf="showWordCount">
                    Words
                </th>
            </ng-container>
        </tr>

        <tr *ngIf="variants">
            <!-- variant selector checkboxes -->
            <th *ngFor="let variant of variants">
                <label *ngIf="treebank.multiOption" class="checkbox" [attr.disabled]="!treebank.multiOption || null">
                    <input type="checkbox" [checked]="variant.selected" [disabled]="!treebank.multiOption || null"
                        (change)="toggleVariant(variant.name)">
                    {{variant.name}}
                </label>
                <label *ngIf="!treebank.multiOption">{{variant.name}}</label>
            </th>
            <th *ngIf="showDescription">
                &nbsp;
            </th>
            <!-- Variant sentence/wordcount col headers -->
            <th *ngFor="let variant of variants.concat('Total')" colspan="2" class="has-text-centered">
                {{variant.name}}
            </th>
        </tr>
    </thead>

    <tbody *ngIf="(!componentGroups || !variants) else withGroups" style="max-height: 500px; overflow-y: auto;">
        <tr *ngFor="let c of components | keyvalue" (click)="toggleComponent(c.value)">
            <!-- TODO move into named template -->
            <td>
                <label [class]="treebank.multiOption ? 'checkbox' : 'radio'" [attr.disabled]="c.value.disabled || null"
                    (click)="$event.stopPropagation()">
                    <input [type]="treebank.multiOption ? 'checkbox' : 'radio'" [disabled]="c.value.disabled"
                        [checked]="c.value.selected" (change)="toggleComponent(c.value)">
                    {{c.value.title}}
                </label>
            </td>

            <td *ngIf="showDescription">{{c.value.description}}</td>
            <td class="is-number">{{c.value.sentenceCount.toLocaleString()}}</td>
            <td class="is-number" *ngIf="showWordCount">{{c.value.wordCount.toLocaleString()}}</td>
        </tr>
    </tbody>
    <ng-template #withGroups>
        <tbody style="max-height: 500px; overflow-y: auto;">
            <tr *ngFor="let group of componentGroups" (click)="toggleGroup(group)">
                <td *ngFor="let variant of variants">
                    <label [class]="treebank.multiOption ? 'checkbox' : 'radio'"
                        [attr.disabled]="components[group.components[variant.name]].disabled || null"
                        (click)="$event.stopPropagation()">
                        <input [type]="treebank.multiOption ? 'checkbox' : 'radio'"
                            [disabled]="components[group.components[variant.name]].disabled"
                            [checked]="components[group.components[variant.name]].selected"
                            (change)="toggleComponent(components[group.components[variant.name]])">
                        {{components[group.components[variant.name]].title}}
                    </label>
                </td>
                <td *ngIf="showDescription">
                    {{group.description}}
                </td>
                <ng-container *ngFor="let variant of variants">
                    <td class="is-number">
                        {{components[group.components[variant.name]].sentenceCount.toLocaleString()}}
                    </td>
                    <td class="is-number" *ngIf="showWordCount">
                        {{components[group.components[variant.name]].wordCount.toLocaleString()}}
                    </td>
                </ng-container>
                <th class="is-number">
                    {{totalSentenceCountByGroup[group.key]}}
                </th>
                <th class="is-number" *ngIf="showWordCount">
                    {{totalWordCountByGroup[group.key]}}
                </th>
            </tr>
        </tbody>
    </ng-template>

    <tfoot>
        <tr>
            <td [attr.colspan]="(variants ? variants.length : 1) + (showDescription ? 1 : 0)">
                &nbsp;
            </td>
            <ng-container *ngFor="let variant of (variants || [])">
                <td class="is-number">{{totalSentenceCountByVariant[variant.name]}}</td>
                <td class="is-number" *ngIf="showWordCount">{{totalWordCountByVariant[variant.name]}}</td>
            </ng-container>
            <th class="is-number">{{totalSentenceCount}}</th>
            <th class="is-number" *ngIf="showWordCount">{{totalWordCount}}</th>
        </tr>
    </tfoot>
</table>
